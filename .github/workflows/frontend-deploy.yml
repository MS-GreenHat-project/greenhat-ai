name: Deploy Frontend to Azure Storage

on:
  push:
    branches:
      - main
      - hjh  # í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ë¸Œëœì¹˜
    paths:
      - 'index.html'  # index.html íŒŒì¼ ë³€ê²½ ì‹œì—ë§Œ íŠ¸ë¦¬ê±°
      - 'assets/**'   # assets í´ë” ë³€ê²½ ì‹œì—ë„ íŠ¸ë¦¬ê±° (í•„ìš”ì‹œ)
      - 'css/**'      # CSS íŒŒì¼ ë³€ê²½ ì‹œì—ë„ íŠ¸ë¦¬ê±° (í•„ìš”ì‹œ)
      - 'js/**'       # JS íŒŒì¼ ë³€ê²½ ì‹œì—ë„ íŠ¸ë¦¬ê±° (í•„ìš”ì‹œ)

jobs:
  deploy-frontend:
    runs-on: ubuntu-latest
    
    env:
      STORAGE_ACCOUNT: greenhat111
      CONTAINER_NAME: '$web'

    steps:
      # 1. GitHub Repo Checkout
      - name: 'Checkout Repository'
        uses: actions/checkout@v4

      # 2. íŒŒì¼ ë³€ê²½ í™•ì¸
      - name: 'Check changed files'
        run: |
          echo "ğŸ“ Preparing to upload files to Storage Account: ${{ env.STORAGE_ACCOUNT }}"
          echo "ğŸ“ Changed files will be uploaded to Blob Storage"
          ls -la index.html

      # 3. Azure Storageì— íŒŒì¼ ì—…ë¡œë“œ
      - name: 'Upload files to Azure Storage'
        run: |
          echo "ğŸ“ Uploading index.html to Storage Account: ${{ env.STORAGE_ACCOUNT }}"
          
          # Storage Account Keyê°€ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
          if [ -z "${{ secrets.AZURE_STORAGE_KEY }}" ]; then
            echo "âŒ AZURE_STORAGE_KEY secret is not set"
            echo "ğŸ’¡ Please add AZURE_STORAGE_KEY to GitHub repository secrets"
            exit 1
          fi
          
          # index.html ì—…ë¡œë“œ
          az storage blob upload \
            --account-name ${{ env.STORAGE_ACCOUNT }} \
            --account-key ${{ secrets.AZURE_STORAGE_KEY }} \
            --container-name '${{ env.CONTAINER_NAME }}' \
            --name index.html \
            --file index.html \
            --content-type "text/html" \
            --overwrite
          
          echo "âœ… index.html uploaded successfully"

      # 4. ë°°í¬ ì™„ë£Œ ì•Œë¦¼
      - name: 'Deployment Summary'
        run: |
          echo "ğŸš€ Frontend deployment completed!"
          echo "ğŸ“ Storage Account: ${{ env.STORAGE_ACCOUNT }}"
          echo "ğŸŒ CDN Endpoint: https://greenhat-bzcacegbe8gtdrd0.a02.azurefd.net"
          echo "ğŸ“ Files updated: index.html"
          echo "â° Deployment time: $(date)"
          echo "ğŸ’¡ CDN cache may take a few minutes to refresh"
